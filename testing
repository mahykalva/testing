# DDL File

CREATE TABLE `raw_as400us.FPWHTD`
(
  header__change_seq STRING,
  header__change_oper STRING,
  header__change_mast STRING,
  header__stream_position STRING,
  header__operation STRING,
  header__transaction_id STRING,
  header__timestamp TIMESTAMP,  
  TDDVID STRING ,
  TDLOID STRING ,
  TDDATE NUMERIC ,
  TDACLN NUMERIC ,
  TDIQTY NUMERIC ,
  TDVLIN NUMERIC ,
  TDLSDT NUMERIC ,
  TDLSTM NUMERIC ,
  TDLSUS STRING ,
  TDLSPG STRING ,
  TDLSJB STRING ,
  landloaddate TIMESTAMP,
  rawrowhash STRING,
  rawloaddate TIMESTAMP,
  sourcemodified TIMESTAMP
);

CREATE TABLE `raw_as400us.FPWHBN`
(
  header__change_seq STRING,
  header__change_oper STRING,
  header__change_mast STRING,
  header__stream_position STRING,
  header__operation STRING,
  header__transaction_id STRING,
  header__timestamp TIMESTAMP,
  BNLOID STRING ,
  BNBINL STRING ,
  BNCOID STRING ,
  BNDVID STRING ,
  BNLZID STRING ,
  BNBTID STRING ,
  BNBNLV NUMERIC ,
  BNPICB STRING ,
  BNRPTB STRING ,
  BNRPFB STRING ,
  BNHOLB STRING ,
  BNNINB STRING ,
  BNHGHT NUMERIC ,
  BNWDTH NUMERIC ,
  BNDPTH NUMERIC ,
  BNVOLU NUMERIC ,
  BNFRAR NUMERIC ,
  BNLETR STRING ,
  BNVELC STRING ,
  BNBULD STRING ,
  BNCRDT NUMERIC ,
  BNCRTM NUMERIC ,
  BNCRUS STRING ,
  BNCHDT NUMERIC ,
  BNCHTM NUMERIC ,
  BNCHUS STRING ,
  BNCHJB STRING ,
  BNCHPG STRING ,
  BNCHSQ NUMERIC ,
  BNCMTF STRING ,
  BNRCST STRING ,
  BNRNGE NUMERIC ,
  landloaddate TIMESTAMP,
  rawrowhash STRING,
  rawloaddate TIMESTAMP,
  sourcemodified TIMESTAMP
);



---landingtoraw_FPWHBN_to_FPWHBN_IDL.sql

INSERT INTO `raw_as400us.FPWHBN`
(
	header__change_seq,
	header__change_oper,
	header__change_mast,
	header__stream_position,
	header__operation,
	header__transaction_id,
	header__timestamp,
    BNLOID,
    BNBINL,
    BNCOID,
    BNDVID,
    BNLZID,
    BNBTID,
    BNBNLV,
    BNPICB,
    BNRPTB,
    BNRPFB,
    BNHOLB,
    BNNINB,
    BNHGHT,
    BNWDTH,
    BNDPTH,
    BNVOLU,
    BNFRAR,
    BNLETR,
    BNVELC,
    BNBULD,
    BNCRDT,
    BNCRTM,
    BNCRUS,
    BNCHDT,
    BNCHTM,
    BNCHUS,
    BNCHJB,
    BNCHPG,
    BNCHSQ,
    BNCMTF,
    BNRCST,
    BNRNGE,
    landloaddate,
	rawrowhash,
    rawloaddate,
    sourcemodified
)
SELECT 
	'IDL',
	'IDL',
	'IDL',
	'IDL',
	'IDL',
	'IDL',
	landloaddate,
    BNLOID,
    BNBINL,
    BNCOID,
    BNDVID,
    BNLZID,
    BNBTID,
    BNBNLV,
    BNPICB,
    BNRPTB,
    BNRPFB,
    BNHOLB,
    BNNINB,
    BNHGHT,
    BNWDTH,
    BNDPTH,
    BNVOLU,
    BNFRAR,
    BNLETR,
    BNVELC,
    BNBULD,
    BNCRDT,
    BNCRTM,
    BNCRUS,
    BNCHDT,
    BNCHTM,
    BNCHUS,
    BNCHJB,
    BNCHPG,
    BNCHSQ,
    BNCMTF,
    BNRCST,
    BNRNGE,
    landloaddate,
    CURRENT_TIMESTAMP() as rawloaddate, 
	CONCAT(
    IFNULL(BNLOID, ''),
    IFNULL(BNBINL, ''),
    IFNULL(BNCOID, ''),
    IFNULL(BNDVID, ''),
    IFNULL(BNLZID, ''),
    IFNULL(BNBTID, ''),
    IFNULL(CAST(BNBNLV AS STRING), ''),
    IFNULL(BNPICB, ''),
    IFNULL(BNRPTB, ''),
    IFNULL(BNRPFB, ''),
    IFNULL(BNHOLB, ''),
    IFNULL(BNNINB, ''),
    IFNULL(CAST(BNHGHT AS STRING), ''),
    IFNULL(CAST(BNWDTH AS STRING), ''),
    IFNULL(CAST(BNDPTH AS STRING), ''),
    IFNULL(CAST(BNVOLU AS STRING), ''),
    IFNULL(CAST(BNFRAR AS STRING), ''),
    IFNULL(BNLETR, ''),
    IFNULL(BNVELC, ''),
    IFNULL(BNBULD, ''),
    IFNULL(CAST(BNCRDT AS STRING), ''),
    IFNULL(CAST(BNCRTM AS STRING), ''),
    IFNULL(BNCRUS, ''),
    IFNULL(CAST(BNCHDT AS STRING), ''),
    IFNULL(CAST(BNCHTM AS STRING), ''),
    IFNULL(BNCHUS, ''),
    IFNULL(BNCHJB, ''),
    IFNULL(BNCHPG, ''),
    IFNULL(CAST(BNCHSQ AS STRING), ''),
    IFNULL(BNCMTF, ''),
    IFNULL(BNRCST, ''),
    IFNULL(CAST(BNRNGE AS STRING), '')
  ) as rawrowhash,
    DATETIME(landloaddate, 'America/New_York') as sourcemodified
FROM 
    `da-qlk-prd-mscdirect.KATHYS.FPWHBN`;

---

INSERT INTO `raw_as400us.FPWHBN`
(
    header__change_seq,
	header__change_oper,
	header__change_mast,
	header__stream_position,
	header__operation,
	header__transaction_id,
	header__timestamp,
    BNLOID,
    BNBINL,
    BNCOID,
    BNDVID,
    BNLZID,
    BNBTID,
    BNBNLV,
    BNPICB,
    BNRPTB,
    BNRPFB,
    BNHOLB,
    BNNINB,
    BNHGHT,
    BNWDTH,
    BNDPTH,
    BNVOLU,
    BNFRAR,
    BNLETR,
    BNVELC,
    BNBULD,
    BNCRDT,
    BNCRTM,
    BNCRUS,
    BNCHDT,
    BNCHTM,
    BNCHUS,
    BNCHJB,
    BNCHPG,
    BNCHSQ,
    BNCMTF,
    BNRCST,
    BNRNGE,
    landloaddate,
	rawrowhash,
    rawloaddate,
    sourcemodified
)
SELECT 
    BNLOID,
    BNBINL,
    BNCOID,
    BNDVID,
    BNLZID,
    BNBTID,
    BNBNLV,
    BNPICB,
    BNRPTB,
    BNRPFB,
    BNHOLB,
    BNNINB,
    BNHGHT,
    BNWDTH,
    BNDPTH,
    BNVOLU,
    BNFRAR,
    BNLETR,
    BNVELC,
    BNBULD,
    BNCRDT,
    BNCRTM,
    BNCRUS,
    BNCHDT,
    BNCHTM,
    BNCHUS,
    BNCHJB,
    BNCHPG,
    BNCHSQ,
    BNCMTF,
    BNRCST,
    BNRNGE,
    landloaddate,
    CURRENT_TIMESTAMP() as rawloaddate, 
	CONCAT(
    IFNULL(BNLOID, ''),
    IFNULL(BNBINL, ''),
    IFNULL(BNCOID, ''),
    IFNULL(BNDVID, ''),
    IFNULL(BNLZID, ''),
    IFNULL(BNBTID, ''),
    IFNULL(CAST(BNBNLV AS STRING), ''),
    IFNULL(BNPICB, ''),
    IFNULL(BNRPTB, ''),
    IFNULL(BNRPFB, ''),
    IFNULL(BNHOLB, ''),
    IFNULL(BNNINB, ''),
    IFNULL(CAST(BNHGHT AS STRING), ''),
    IFNULL(CAST(BNWDTH AS STRING), ''),
    IFNULL(CAST(BNDPTH AS STRING), ''),
    IFNULL(CAST(BNVOLU AS STRING), ''),
    IFNULL(CAST(BNFRAR AS STRING), ''),
    IFNULL(BNLETR, ''),
    IFNULL(BNVELC, ''),
    IFNULL(BNBULD, ''),
    IFNULL(CAST(BNCRDT AS STRING), ''),
    IFNULL(CAST(BNCRTM AS STRING), ''),
    IFNULL(BNCRUS, ''),
    IFNULL(CAST(BNCHDT AS STRING), ''),
    IFNULL(CAST(BNCHTM AS STRING), ''),
    IFNULL(BNCHUS, ''),
    IFNULL(BNCHJB, ''),
    IFNULL(BNCHPG, ''),
    IFNULL(CAST(BNCHSQ AS STRING), ''),
    IFNULL(BNCMTF, ''),
    IFNULL(BNRCST, ''),
    IFNULL(CAST(BNRNGE AS STRING), '')
  ) as rawrowhash,
    DATETIME(landloaddate, 'America/New_York') as sourcemodified
FROM 
    `da-qlk-prd-mscdirect.KATHYS.FPWHBN__CT`
	WHERE landloaddate>(SELECT MAX(landloaddate) FROM `da-qlk-prd-mscdirect.raw_as400us.FPWHBN`);


-----------

INSERT INTO `raw_as400us.FPWHTD`
(
 header__change_seq,
 header__change_oper,
 header__change_mast,
 header__stream_position,
 header__operation,
 header__transaction_id,
 header__timestamp,
  TDDVID,
  TDLOID,
  TDDATE,
  TDACLN,
  TDIQTY,
  TDVLIN,
  TDLSDT,
  TDLSTM,
  TDLSUS,
  TDLSPG,
  TDLSJB,
  landloaddate,
  rawrowhash,
  rawloaddate,
  sourcemodified
)
SELECT 
	'IDL',
	'IDL',
	'IDL',
	'IDL',
	'IDL',
	'IDL',
	landloaddate,
  TDDVID,
  TDLOID,
  TDDATE,
  TDACLN,
  TDIQTY,
  TDVLIN,
  TDLSDT,
  TDLSTM,
  TDLSUS,
  TDLSPG,
  TDLSJB,
  landloaddate,
  CURRENT_TIMESTAMP() AS rawloaddate,
  LAST((CONCAT(
    IFNULL(TDDVID, ''),
    IFNULL(TDLOID, ''),
    IFNULL(CAST(TDDATE AS STRING), ''),
    IFNULL(CAST(TDACLN AS STRING), ''),
    IFNULL(CAST(TDIQTY AS STRING), ''),
    IFNULL(CAST(TDVLIN AS STRING), ''),
    IFNULL(CAST(TDLSDT AS STRING), ''),
    IFNULL(CAST(TDLSTM AS STRING), ''),
    IFNULL(TDLSUS, ''),
    IFNULL(TDLSPG, ''),
    IFNULL(TDLSJB, '')
  ))) AS rowhash, 
  DATETIME(landloaddate, 'America/New_York') AS sourcemodified
FROM 
  `da-qlk-prd-mscdirect.KATHYS.FPWHTD`;



